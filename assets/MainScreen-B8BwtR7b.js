var Wt=Object.defineProperty;var It=(a,e,t)=>e in a?Wt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var r=(a,e,t)=>It(a,typeof e!="symbol"?e+"":e,t);import{a as Rt,G as kt,L as X,R as xt,d as _,v as Ht,aa as At,ab as Ot,ac as at,ad as Ft,ae as Nt,z as y,h as p,O as w,af as o,ag as v,ah as m,ai as u,aj as $,ak as L,al as x,am as g,an as B,ao as rt,ap as nt}from"./index-G4nboQjO.js";import{F as bt}from"./Filter-B-PGukUE.js";import{H as zt,m as Gt,N as M}from"./NineSliceGeometry-CLwybkFa.js";import"./State-3sV0XrC-.js";const St={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Ut=["in vec2 vBlurTexCoords[%size%];","uniform sampler2D uTexture;","out vec4 finalColor;","void main(void)","{","    finalColor = vec4(0.0);","    %blur%","}"].join(`
`);function Yt(a){const e=St[a],t=e.length;let i=Ut,s="";const n="finalColor += texture(uTexture, vBlurTexCoords[%index%]) * %value%;";let l;for(let h=0;h<a;h++){let d=n.replace("%index%",h.toString());l=h,h>=t&&(l=a-h-1),d=d.replace("%value%",e[l].toString()),s+=d,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",a.toString()),i}const Xt=`
    in vec2 aPosition;

    uniform float uStrength;

    out vec2 vBlurTexCoords[%size%];

    uniform vec4 uInputSize;
    uniform vec4 uOutputFrame;
    uniform vec4 uOutputTexture;

    vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;

    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

    vec2 filterTextureCoord( void )
    {
        return aPosition * (uOutputFrame.zw * uInputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        float pixelStrength = uInputSize.%dimension% * uStrength;

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Vt(a,e){const t=Math.ceil(a/2);let i=Xt,s="",n;e?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let l=0;l<a;l++){let h=n.replace("%index%",l.toString());h=h.replace("%sampleIndex%",`${l-(t-1)}.0`),s+=h,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",a.toString()),i=i.replace("%dimension%",e?"z":"w"),i}function $t(a,e){const t=Vt(e,a),i=Yt(e);return Rt.from({vertex:t,fragment:i,name:`blur-${a?"horizontal":"vertical"}-pass-filter`})}var qt=`

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct BlurUniforms {
  uStrength:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    %blur-struct%
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}


@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {

  let filteredCord = filterTextureCoord(aPosition);

  let pixelStrength = gfu.uInputSize.%dimension% * blurUniforms.uStrength;

  return VSOutput(
   filterVertexPosition(aPosition),
    %blur-vertex-out%
  );
}

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  %blur-fragment-in%
) -> @location(0) vec4<f32> {

    var   finalColor = vec4(0.0);

    %blur-sampling%

    return finalColor;
}`;function jt(a,e){const t=St[e],i=t.length,s=[],n=[],l=[];for(let f=0;f<e;f++){s[f]=`@location(${f}) offset${f}: vec2<f32>,`,a?n[f]=`filteredCord + vec2(${f-i+1} * pixelStrength, 0.0),`:n[f]=`filteredCord + vec2(0.0, ${f-i+1} * pixelStrength),`;const E=f<i?f:e-f-1,D=t[E].toString();l[f]=`finalColor += textureSample(uTexture, uSampler, offset${f}) * ${D};`}const h=s.join(`
`),d=n.join(`
`),c=l.join(`
`),b=qt.replace("%blur-struct%",h).replace("%blur-vertex-out%",d).replace("%blur-fragment-in%",h).replace("%blur-sampling%",c).replace("%dimension%",a?"z":"w");return kt.from({vertex:{source:b,entryPoint:"mainVertex"},fragment:{source:b,entryPoint:"mainFragment"}})}const vt=class Ct extends bt{constructor(e){e={...Ct.defaultOptions,...e};const t=$t(e.horizontal,e.kernelSize),i=jt(e.horizontal,e.kernelSize);super({glProgram:t,gpuProgram:i,resources:{blurUniforms:{uStrength:{value:0,type:"f32"}}},...e}),this.horizontal=e.horizontal,this._quality=0,this.quality=e.quality,this.blur=e.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(e,t,i,s){if(this._uniforms.uStrength=this.strength/this.passes,this.passes===1)e.applyFilter(this,t,i,s);else{const n=X.getSameSizeTexture(t);let l=t,h=n;this._state.blend=!1;const d=e.renderer.type===xt.WEBGPU;for(let c=0;c<this.passes-1;c++){e.applyFilter(this,l,h,c===0?!0:d);const b=h;h=l,l=b}this._state.blend=!0,e.applyFilter(this,l,i,s),X.returnTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}};vt.defaultOptions={strength:8,quality:4,kernelSize:5};let J=vt;class q extends bt{constructor(...e){let t=e[0]??{};typeof t=="number"&&(_(Ht,"BlurFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }"),t={strength:t},e[1]!==void 0&&(t.quality=e[1]),e[2]!==void 0&&(t.resolution=e[2]||"inherit"),e[3]!==void 0&&(t.kernelSize=e[3])),t={...J.defaultOptions,...t};const{strength:i,strengthX:s,strengthY:n,quality:l,...h}=t;super({...h,compatibleRenderers:xt.BOTH,resources:{}}),this._repeatEdgePixels=!1,this.blurXFilter=new J({horizontal:!0,...t}),this.blurYFilter=new J({horizontal:!1,...t}),this.quality=l,this.strengthX=s??i,this.strengthY=n??i,this.repeatEdgePixels=!1}apply(e,t,i,s){const n=Math.abs(this.blurXFilter.strength),l=Math.abs(this.blurYFilter.strength);if(n&&l){const h=X.getSameSizeTexture(t);this.blurXFilter.blendMode="normal",this.blurXFilter.apply(e,t,h,!0),this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(e,h,i,s),X.returnTexture(h)}else l?(this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(e,t,i,s)):(this.blurXFilter.blendMode=this.blendMode,this.blurXFilter.apply(e,t,i,s))}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))*2}get strength(){if(this.strengthX!==this.strengthY)throw new Error("BlurFilter's strengthX and strengthY are different");return this.strengthX}set strength(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get strengthX(){return this.blurXFilter.blur}set strengthX(e){this.blurXFilter.blur=e,this.updatePadding()}get strengthY(){return this.blurYFilter.blur}set strengthY(e){this.blurYFilter.blur=e,this.updatePadding()}get blur(){return _("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength}set blur(e){_("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength=e}get blurX(){return _("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX}set blurX(e){_("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX=e}get blurY(){return _("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY}set blurY(e){_("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}q.defaultOptions={strength:8,quality:4,kernelSize:5};class Kt extends At{constructor(...e){const t=Ot(e,"HtmlText");super(t,zt),this.renderPipeId="htmlText",t.textureStyle&&(this.textureStyle=t.textureStyle instanceof at?t.textureStyle:new at(t.textureStyle))}updateBounds(){const e=this._bounds,t=this._anchor,i=Gt(this.text,this._style),{width:s,height:n}=i;e.minX=-t._x*s,e.maxX=e.minX+s,e.minY=-t._y*n,e.maxY=e.minY+n}}const wt=class Tt extends Ft{constructor(e){var E,D,j,K;e instanceof y&&(e={texture:e});const{width:t,height:i,anchor:s,leftWidth:n,rightWidth:l,topHeight:h,bottomHeight:d,texture:c,roundPixels:b,...f}=e;super({label:"NineSliceSprite",...f}),this.renderPipeId="nineSliceSprite",this.batched=!0,this._leftWidth=n??((E=c==null?void 0:c.defaultBorders)==null?void 0:E.left)??M.defaultOptions.leftWidth,this._topHeight=h??((D=c==null?void 0:c.defaultBorders)==null?void 0:D.top)??M.defaultOptions.topHeight,this._rightWidth=l??((j=c==null?void 0:c.defaultBorders)==null?void 0:j.right)??M.defaultOptions.rightWidth,this._bottomHeight=d??((K=c==null?void 0:c.defaultBorders)==null?void 0:K.bottom)??M.defaultOptions.bottomHeight,this._width=t??c.width??M.defaultOptions.width,this._height=i??c.height??M.defaultOptions.height,this.allowChildren=!1,this.texture=c??Tt.defaultOptions.texture,this.roundPixels=b??!1,this._anchor=new Nt({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:this.texture.defaultAnchor&&(this.anchor=this.texture.defaultAnchor)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get width(){return this._width}set width(e){this._width=e,this.onViewUpdate()}get height(){return this._height}set height(e){this._height=e,this.onViewUpdate()}setSize(e,t){typeof e=="object"&&(t=e.height??e.width,e=e.width),this._width=e,this._height=t??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}get leftWidth(){return this._leftWidth}set leftWidth(e){this._leftWidth=e,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(e){this._topHeight=e,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(e){this._rightWidth=e,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(e){this._bottomHeight=e,this.onViewUpdate()}get texture(){return this._texture}set texture(e){e||(e=y.EMPTY);const t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}destroy(e){if(super.destroy(e),typeof e=="boolean"?e:e==null?void 0:e.texture){const i=typeof e=="boolean"?e:e==null?void 0:e.textureSource;this._texture.destroy(i)}this._texture=null}updateBounds(){const e=this._bounds,t=this._anchor,i=this._width,s=this._height;e.minX=-t._x*i,e.maxX=e.minX+i,e.minY=-t._y*s,e.maxY=e.minY+s}};wt.defaultOptions={texture:y.EMPTY};let U=wt;const Jt=[{text:"привет меня зовут асель и я ваш ментор",difficulty:"easy"},{text:"сегодня мы изучаем основы предпринимательства",difficulty:"easy"},{text:"ваша задача создать успешный стартап за десять недель",difficulty:"medium"},{text:"помните что клиент всегда должен быть в центре вашего внимания",difficulty:"medium"},{text:"валидация гипотез это основа любого успешного бизнеса в современном мире",difficulty:"hard"},{text:"не забывайте анализировать конкурентов и постоянно улучшать свой продукт",difficulty:"hard"},{text:"инвесторы ищут команды которые могут масштабировать свой бизнес глобально",difficulty:"hard"},{text:"метрики и аналитика помогут вам принимать правильные решения",difficulty:"medium"},{text:"пользовательский опыт должен быть простым и интуитивным",difficulty:"medium"},{text:"монетизация должна быть встроена в продукт с самого начала",difficulty:"medium"}],T=class T{static getRandomText(){const e=Math.floor(Math.random()*T.texts.length);return T.texts[e]}static getRandomTextByDifficulty(e){const t=T.texts.filter(s=>s.difficulty===e);if(t.length===0)return T.getRandomText();const i=Math.floor(Math.random()*t.length);return t[i]}static getAllTexts(){return[...T.texts]}static getTextsByDifficulty(e){return T.texts.filter(t=>t.difficulty===e)}static calculateBossHealth(e){return e.length}static calculateWordDamage(e){return e.length*2}static getTextCount(){return T.texts.length}static getTextCountByDifficulty(e){return T.texts.filter(t=>t.difficulty===e).length}};r(T,"texts",Jt);let V=T;class Zt extends p{constructor(){super();r(this,"bossSprite");r(this,"healthBarBg");r(this,"healthBarFill");r(this,"healthLabel");r(this,"currentHealth",100);r(this,"maxHealth",100);r(this,"HEALTH_BAR_WIDTH",200);r(this,"HEALTH_BAR_HEIGHT",20);r(this,"isDefeated",!1);r(this,"onDefeated");this.bossSprite=new w(y.WHITE),this.bossSprite.width=80,this.bossSprite.height=120,this.bossSprite.tint=o.COLORS.MONSTER,this.bossSprite.anchor.set(.5,1),this.addChild(this.bossSprite),this.healthBarBg=new v,this.healthBarBg.rect(-this.HEALTH_BAR_WIDTH/2,-160,this.HEALTH_BAR_WIDTH,this.HEALTH_BAR_HEIGHT),this.healthBarBg.fill(3355443),this.healthBarBg.stroke({color:6710886,width:2}),this.addChild(this.healthBarBg),this.healthBarFill=new v,this.addChild(this.healthBarFill),this.healthLabel=new m({text:"100 / 100",style:{fontSize:16,fill:16777215,fontWeight:"bold"}}),this.healthLabel.anchor.set(.5),this.healthLabel.y=-140,this.addChild(this.healthLabel),this.x=o.MONSTER_X,this.y=0,this.updateHealthBar()}setHealth(t){this.maxHealth=t,this.currentHealth=t,this.isDefeated=!1,this.updateHealthBar()}takeDamage(t){if(this.isDefeated)return;const i=t+1;this.currentHealth=Math.max(0,this.currentHealth-i),console.log(`Boss took ${i} damage (word length: ${t}), health: ${this.currentHealth}/${this.maxHealth}`),this.updateHealthBar(),this.playHitAnimation(),this.currentHealth<=0&&this.defeat()}updateHealthBar(){if(this.healthBarFill.clear(),this.currentHealth>0){const t=this.currentHealth/this.maxHealth*this.HEALTH_BAR_WIDTH,i=this.currentHealth/this.maxHealth;let s=65280;i<.6&&(s=16776960),i<.3&&(s=16711680),this.healthBarFill.rect(-this.HEALTH_BAR_WIDTH/2,-160,t,this.HEALTH_BAR_HEIGHT),this.healthBarFill.fill(s)}this.healthLabel.text=`${this.currentHealth} / ${this.maxHealth}`}playHitAnimation(){const t=this.bossSprite.tint;this.bossSprite.tint=16711680;const i=this.x;u(this,{x:i+10},{duration:.05}).then(()=>{u(this,{x:i-10},{duration:.05}).then(()=>{u(this,{x:i},{duration:.05})})}),setTimeout(()=>{this.bossSprite.tint=t},100)}defeat(){this.isDefeated||(this.isDefeated=!0,console.log("Boss defeated!"),u(this.bossSprite,{alpha:0,scale:{x:1.5,y:1.5}},{duration:1,ease:"easeOut"}),u(this,{y:this.y+100},{duration:1,ease:"easeIn"}).then(()=>{this.onDefeated&&this.onDefeated()}))}async show(){const t=this.x;this.x=t+200,this.alpha=0,await u(this,{alpha:1,x:t},{duration:1,ease:"backOut"})}async hide(){await u(this,{alpha:0,x:this.x+200},{duration:.5,ease:"easeIn"})}getCurrentHealth(){return this.currentHealth}getMaxHealth(){return this.maxHealth}getHealthPercentage(){return this.maxHealth===0?0:this.currentHealth/this.maxHealth}reset(){this.currentHealth=this.maxHealth,this.isDefeated=!1,this.alpha=1,this.bossSprite.alpha=1,this.bossSprite.scale.set(1),this.bossSprite.tint=o.COLORS.MONSTER,this.x=o.MONSTER_X,this.y=0,this.updateHealthBar()}update(t){}}class Qt extends p{constructor(){super();r(this,"bulletGraphics");r(this,"target",null);r(this,"velocityX",0);r(this,"velocityY",0);r(this,"speed",o.BULLET_SPEED);r(this,"shouldBeDestroyed",!1);r(this,"hasReachedTarget",!1);r(this,"bulletSize",o.BULLET_SIZE);r(this,"trailPoints",[]);r(this,"maxTrailLength",8);this.createBulletGraphics()}createBulletGraphics(){this.bulletGraphics=new v,this.bulletGraphics.circle(0,0,this.bulletSize).fill(o.BULLET_COLOR),this.bulletGraphics.circle(0,0,this.bulletSize*1.5).fill({color:o.BULLET_COLOR,alpha:.3}),this.addChild(this.bulletGraphics),this.scale.set(0),u(this.scale,{x:1,y:1},{duration:.1,ease:"backOut"})}setTarget(t){this.target=t,this.calculateVelocity()}calculateVelocity(){if(!this.target)return;const t=this.target.x-this.x,i=this.target.y-this.y,s=Math.sqrt(t*t+i*i);s>0&&(this.velocityX=t/s*this.speed,this.velocityY=i/s*this.speed,console.log(`Bullet velocity calculated: vx=${this.velocityX.toFixed(2)}, vy=${this.velocityY.toFixed(2)}, distance=${s.toFixed(2)}`))}update(t){this.shouldBeDestroyed||(this.updateTrail(),this.x+=this.velocityX*t,this.y+=this.velocityY*t,this.checkTargetCollision(),this.checkBounds(),this.target&&!this.hasReachedTarget&&Math.random()<.1&&this.calculateVelocity())}updateTrail(){this.trailPoints.unshift({x:this.x,y:this.y,alpha:1}),this.trailPoints.length>this.maxTrailLength&&this.trailPoints.pop(),this.trailPoints.forEach((t,i)=>{t.alpha=1-i/this.maxTrailLength})}drawTrail(){if(this.trailPoints.length<2)return;const t=new v;for(let i=0;i<this.trailPoints.length-1;i++){const s=this.trailPoints[i],n=this.trailPoints[i+1],l=this.bulletSize*s.alpha/2;t.moveTo(s.x,s.y).lineTo(n.x,n.y).stroke({color:o.BULLET_COLOR,alpha:s.alpha*.5,width:l})}this.parent&&(this.parent.addChildAt(t,0),setTimeout(()=>{t.parent&&t.parent.removeChild(t),t.destroy()},100))}checkTargetCollision(){if(!this.target||this.hasReachedTarget)return;const t=this.x-this.target.x,i=this.y-this.target.y;Math.sqrt(t*t+i*i)<50&&this.hitTarget()}hitTarget(){this.hasReachedTarget=!0,this.createHitEffect(),this.shouldBeDestroyed=!0}createHitEffect(){u(this.scale,{x:2,y:2},{duration:.2,ease:"backOut"}),u(this.alpha,0,{duration:.2}),this.drawTrail()}checkBounds(){const t=o.GAME_WIDTH,i=o.GAME_HEIGHT;(this.x<-t-500||this.x>t+500||this.y<-i-500||this.y>i+500)&&(console.log(`Bullet destroyed by bounds check at (${this.x.toFixed(2)}, ${this.y.toFixed(2)})`),this.shouldBeDestroyed=!0)}shouldDestroy(){return this.shouldBeDestroyed}getTarget(){return this.target}hasHitTarget(){return this.hasReachedTarget}destroy(){this.shouldBeDestroyed=!0,this.alpha>0?u(this.alpha,0,{duration:.1}).then(()=>{super.destroy()}):super.destroy()}}class te extends p{constructor(){super();r(this,"playerDefaultSprite");r(this,"playerKeyboardSprite");r(this,"bullets",[]);r(this,"bulletContainer");r(this,"currentTarget",null);r(this,"playerX");r(this,"playerY");r(this,"playerSize",400);r(this,"isAnimating",!1);this.playerX=o.PLAYER_X,this.playerY=0,this.bulletContainer=new p,this.addChild(this.bulletContainer),this.createPlayerGraphics(),this.x=this.playerX,this.y=this.playerY}createPlayerGraphics(){this.playerDefaultSprite=new w(y.from("main/player/0.PNG")),this.playerDefaultSprite.anchor.set(.5),this.playerDefaultSprite.width=this.playerSize,this.playerDefaultSprite.height=this.playerSize,this.playerKeyboardSprite=new w(y.from("main/player/1.PNG")),this.playerKeyboardSprite.anchor.set(.5),this.playerKeyboardSprite.width=this.playerSize,this.playerKeyboardSprite.height=this.playerSize,this.playerKeyboardSprite.visible=!1,this.addChild(this.playerDefaultSprite),this.addChild(this.playerKeyboardSprite)}setTarget(t){this.currentTarget=t}getCurrentTarget(){return this.currentTarget}shootBullet(){if(!this.currentTarget){console.log("No target to shoot at");return}const t=new Qt,i=this.x+this.playerSize*.3,s=this.y;t.x=i,t.y=s,t.setTarget(this.currentTarget),this.parent&&this.parent.addChild(t),this.bullets.push(t),this.playShootAnimation()}playShootAnimation(){if(this.isAnimating)return;this.isAnimating=!0,this.setKeyboardState(!0);const t={x:this.scale.x,y:this.scale.y};u(this.scale,{x:1.1,y:1.1},{duration:.1}).then(()=>{u(this.scale,t,{duration:.1}).then(()=>{this.isAnimating=!1,setTimeout(()=>{this.setKeyboardState(!1)},200)})})}setKeyboardState(t){this.playerDefaultSprite.visible=!t,this.playerKeyboardSprite.visible=t}update(t){this.updateBullets(t)}updateBullets(t){this.bullets=this.bullets.filter(i=>(i.update(t),i.shouldDestroy()?(i.parent&&i.parent.removeChild(i),i.destroy(),!1):!0))}getBullets(){return[...this.bullets]}clearBullets(){this.bullets.forEach(t=>{t.parent&&t.parent.removeChild(t),t.destroy()}),this.bullets=[]}getBulletCount(){return this.bullets.length}destroy(){this.clearBullets(),super.destroy()}}class Pt extends p{constructor(){super();r(this,"bg");r(this,"panel");r(this,"title");r(this,"doneButton");r(this,"panelBase");this.bg=new w(y.WHITE),this.bg.tint=0,this.bg.interactive=!0,this.addChild(this.bg),this.panel=new p,this.addChild(this.panel),this.panelBase=new $({height:300}),this.panel.addChild(this.panelBase),this.title=new m({text:"Paused",style:{fill:1118481,fontSize:50}}),this.title.y=-80,this.panel.addChild(this.title),this.doneButton=new L({text:"▶️",style:{fontSize:80,fill:1118481,fontWeight:"bold",align:"center"}}),this.doneButton.anchor.set(.5),this.doneButton.y=60,this.doneButton.eventMode="static",this.doneButton.cursor="pointer",this.doneButton.on("pointerup",()=>x().navigation.dismissPopup()),this.panel.addChild(this.doneButton)}resize(t,i){this.bg.width=t,this.bg.height=i,this.panel.x=t*.5,this.panel.y=i*.5}async show(){const t=x();t.navigation.currentScreen&&(t.navigation.currentScreen.filters=[new q({strength:5})]),this.bg.alpha=0,this.panel.pivot.y=-400,u(this.bg,{alpha:.8},{duration:.2,ease:"linear"}),await u(this.panel.pivot,{y:0},{duration:.3,ease:"backOut"})}async hide(){const t=x();t.navigation.currentScreen&&(t.navigation.currentScreen.filters=[]),u(this.bg,{alpha:0},{duration:.2,ease:"linear"}),await u(this.panel.pivot,{y:-500},{duration:.3,ease:"backIn"})}}const ee=[{text:"почему порты закрыты?",author:"бернар",level:1},{text:"я секси дверь чикуля",author:"бахр",level:1},{text:"я бахауддин",author:"бахр",level:1},{text:"ребята промоушн",author:"асель",level:2},{text:"сейчас будет аттенданс",author:"диана",level:1},{text:"два пропуска то кик",author:"диана",level:1},{text:"пять постов иначе прощайте",author:"асель",level:2},{text:"чекайте дискорд время от времени",author:"диана",level:1},{text:"когда релиз",author:"алихан",level:1},{text:"скорее ты уйдешь",author:"алихан",level:1},{text:"Он даже не знает, что его скоро кикнут",author:"бахр",level:1},{text:"заполните таблицу прогресса",author:"диана",level:1},{text:"питчинг в десять",author:"асель",level:2},{text:"завтра гостевая лекция",author:"диана",level:1},{text:"щас будет аттенданс пять минут на то чтобы прийти",author:"баха",level:1},{text:"где ваши домашки",author:"баха",level:1},{text:"киллер фича",author:"алихан",level:1},{text:"дейлик в девять утра",author:"алихан",level:1},{text:"кто оставил зарядку",author:"бернар",level:1},{text:"суббота волейбол",author:"бахр",level:1},{text:"в воскресенье в кокжайлау",author:"бахр",level:1},{text:"ребята у вас все хорошо",author:"асель",level:2},{text:"заходим в зум",author:"асель",level:2},{text:"регистрируйтесь быстро",author:"асель",level:2},{text:"мы не уйдем пока не добьем шестьдесят юзеров",author:"асель",level:2},{text:"демонстрацию выключите",author:"асель",level:2},{text:"мы программисты или кто",author:"асель",level:2},{text:"почему у всех дизайн одинаковый",author:"асель",level:2},{text:"покажите ваш прогресс",author:"асель",level:2},{text:"где ваша гугл аналитика",author:"асель",level:2},{text:"почему нет промоушина",author:"асель",level:2},{text:"можете начинать занимать очередь",author:"диана",level:1}],S=class S{static getRandomMessage(){const e=Math.floor(Math.random()*S.messages.length);return S.messages[e]}static getRandomMessageByLevel(e){const t=S.messages.filter(s=>s.level===e);if(t.length===0)return S.getRandomMessage();const i=Math.floor(Math.random()*t.length);return t[i]}static getRandomMessages(e){const t=[];for(let i=0;i<e;i++)t.push(S.getRandomMessage());return t}static getMessagesByLevel(e){return S.messages.filter(t=>t.level===e)}static getAllMessages(){return[...S.messages]}static getRandomMessageText(){return S.getRandomMessage().text}static getRandomMessageTextByLevel(e){return S.getRandomMessageByLevel(e).text}static isValidMessage(e){return S.messages.some(t=>t.text.toLowerCase()===e.toLowerCase())}static getMessageByText(e){return S.messages.find(t=>t.text.toLowerCase()===e.toLowerCase())||null}static getMessageCount(){return S.messages.length}static getMessageCountByLevel(e){return S.messages.filter(t=>t.level===e).length}};r(S,"messages",ee);let st=S;const ie={width:200,maxWidth:300,padding:12,rightPadding:40,cornerRadius:12,backgroundColor:1842466,leftStrokeColor:16776960,leftStrokeWidth:3,senderNameColor:16777215,messageColor:16777215,senderNameSize:24,messageSize:24,profileSize:28},Z={бернар:"main/mentors/0.JPG",алихан:"main/mentors/1.JPG",диана:"main/mentors/2.JPG",асель:"main/mentors/3.JPG",бахр:"main/mentors/4.JPG",баха:"main/mentors/5.JPG"};class se extends p{constructor(t,i,s={}){super();r(this,"background");r(this,"senderName");r(this,"messageText");r(this,"profilePicture");r(this,"textContainer");const n={...ie,...s};this.textContainer=new p,this.addChild(this.textContainer);const l=Z[t.toLowerCase()]||"main/mentors/0.JPG";this.profilePicture=new w(y.from(l)),this.profilePicture.width=n.profileSize,this.profilePicture.height=n.profileSize,this.profilePicture.anchor.set(.5),this.profilePicture.x=n.profileSize*.5+n.padding,this.profilePicture.y=n.padding+n.profileSize*.5,this.addChild(this.profilePicture);const h=new v().circle(0,0,n.profileSize*.5).fill({color:16777215});h.x=this.profilePicture.x,h.y=this.profilePicture.y,this.profilePicture.mask=h,this.addChild(h),this.senderName=new L({text:t,style:{fontSize:n.senderNameSize,fill:n.senderNameColor,fontWeight:"bold"}}),this.senderName.anchor.x=0,this.senderName.x=n.padding,this.senderName.y=n.padding,this.textContainer.addChild(this.senderName),this.messageText=new L({text:i,style:{fontSize:n.messageSize,fill:n.messageColor,wordWrap:!0,wordWrapWidth:n.maxWidth-n.padding*2-n.rightPadding}}),this.messageText.anchor.x=0,this.messageText.x=n.padding,this.messageText.y=n.padding+Math.max(this.senderName.height,n.profileSize)+4,this.textContainer.addChild(this.messageText);const d=Math.max(this.senderName.x+this.senderName.width,this.messageText.width),c=Math.max(this.senderName.height,n.profileSize)+this.messageText.height+8,b=Math.min(d+n.padding*2+n.rightPadding,n.maxWidth),f=c+n.padding*2;this.background=new v().roundRect(0,0,b,f,n.cornerRadius).fill({color:n.backgroundColor}),this.background.roundRect(0,0,n.leftStrokeWidth,f,n.cornerRadius).fill({color:n.leftStrokeColor}),this.addChildAt(this.background,0),this.textContainer.x=(b-d)*.5}updateMessage(t,i){this.senderName.text=t,this.messageText.text=i;const s=Z[t.toLowerCase()]||"main/mentors/0.JPG";this.profilePicture.texture=y.from(s);const n=Math.max(this.senderName.x+this.senderName.width,this.messageText.width);this.textContainer.x=(this.background.width-n)*.5}setSenderName(t){this.senderName.text=t;const i=Z[t.toLowerCase()]||"main/mentors/0.JPG";this.profilePicture.texture=y.from(i)}setMessage(t){this.messageText.text=t}get bubbleWidth(){return this.background.width}get bubbleHeight(){return this.background.height}}class Q extends p{constructor(t,i,s){super();r(this,"targetText");r(this,"typedProgress",0);r(this,"messageBubble");r(this,"speed");r(this,"velocityX");r(this,"velocityY");r(this,"isActive",!1);r(this,"isCompleted",!1);r(this,"hasReachedEdge",!1);r(this,"directionMultiplier",-1);r(this,"isPlayerMessage",!1);this.targetText=t.toLowerCase(),this.speed=i||o.WORD_SPEED;const n=(Math.random()-.5)*Math.PI/3;this.velocityX=-this.speed*Math.cos(n),this.velocityY=this.speed*Math.sin(n),this.messageBubble=new se(s||"Mentor",this.targetText,{maxWidth:o.MESSAGE_MAX_WIDTH,messageSize:20,senderNameSize:20}),this.messageBubble.x=-this.messageBubble.bubbleWidth*.5,this.messageBubble.y=-this.messageBubble.bubbleHeight*.5,this.addChild(this.messageBubble),this.x=o.WORD_SPAWN_X,this.y=this.getRandomSpawnY(),this.alpha=0,setTimeout(()=>{this.alpha=1},o.FADE_IN_DURATION*1e3)}setDirection(t){this.directionMultiplier=t,this.isPlayerMessage=t===1;const i=(Math.random()-.5)*Math.PI/3;this.velocityX=this.directionMultiplier*this.speed*Math.cos(i),this.velocityY=this.speed*Math.sin(i)}isPlayerWord(){return this.isPlayerMessage}update(t){if(this.isCompleted)return;this.x+=this.velocityX*t,this.y+=this.velocityY*t;const i=o.GAME_HEIGHT;this.y<-i/2&&(this.y=-i/2,this.velocityY=-this.velocityY),this.y>i/2&&(this.y=i/2,this.velocityY=-this.velocityY),this.directionMultiplier<0?this.x<o.WORD_DESTROY_X&&(this.hasReachedEdge=!0):this.x>o.WORD_SPAWN_X&&(this.hasReachedEdge=!0)}typeCharacter(t){if(this.isCompleted||!this.isActive)return!1;const i=this.targetText[this.typedProgress];return t.toLowerCase()===i?(this.typedProgress++,this.updateMessageDisplay(),this.typedProgress>=this.targetText.length&&this.complete(),!0):(this.showError(),!1)}setActive(t){this.isActive=t,t?this.scale.set(1.1,1.1):this.scale.set(1,1)}getRemainingText(){return this.targetText.slice(this.typedProgress)}getTypedText(){return this.targetText.slice(0,this.typedProgress)}complete(){this.isCompleted=!0,this.isActive=!1,this.scale.set(1.5,1.5),setTimeout(()=>{this.alpha=0},o.WORD_DESTROY_ANIMATION*1e3)}showError(){const t=this.messageBubble.background.tint;this.messageBubble.background.tint=16711680,this.scale.set(.9,.9),setTimeout(()=>{this.scale.set(1,1),this.messageBubble.background.tint=t},100)}updateMessageDisplay(){this.messageBubble.setMessage(this.targetText)}getRandomSpawnY(){const{min:t,max:i}=o.WORD_SPAWN_Y_RANGE;return Math.random()*(i-t)+t}getNextCharacter(){return this.typedProgress>=this.targetText.length?null:this.targetText[this.typedProgress]}matchesInput(t){return this.targetText.startsWith(t.toLowerCase())}resetProgress(){this.typedProgress=0,this.isCompleted=!1,this.hasReachedEdge=!1,this.updateMessageDisplay()}async destroy(){this.alpha=0,this.parent&&this.parent.removeChild(this)}}class re{constructor(e){r(this,"container");r(this,"activeWords",[]);r(this,"spawnTimer",0);r(this,"spawnInterval",o.WORD_SPAWN_INTERVAL);r(this,"currentDifficulty","easy");r(this,"maxWords",5);r(this,"isSpawning",!0);r(this,"onWordReachedEdge");r(this,"onWordCompleted");r(this,"onLevelAdvance");r(this,"remainingMessages",[]);r(this,"totalMessages",0);this.container=e,this.initializeLevel()}update(e){this.spawnTimer+=e*1e3,this.spawnTimer>=this.spawnInterval&&console.log("WordSpawner - update: spawn timer ready",{isSpawning:this.isSpawning,spawnTimer:this.spawnTimer,spawnInterval:this.spawnInterval,activeWordsCount:this.activeWords.length,maxWords:this.maxWords,remainingMessages:this.remainingMessages.length}),this.isSpawning&&this.spawnTimer>=this.spawnInterval&&this.activeWords.length<this.maxWords&&(console.log("WordSpawner - spawning word now"),this.spawnWord(),this.spawnTimer=0),this.updateWords(e),this.cleanupWords()}spawnWord(){if(this.remainingMessages.length===0){console.log("WordSpawner - no more messages to spawn");return}const e=Math.floor(Math.random()*this.remainingMessages.length),t=this.remainingMessages[e];this.remainingMessages.splice(e,1),console.log("WordSpawner - spawning word:",t.text,"by:",t.author,"remaining:",this.remainingMessages.length),this.updateLevelProgress();const i=this.getSpeedForDifficulty(),s=new Q(t.text,i,t.author),n=this.getSpawnPosition(t);s.x=n.x,s.y=n.y,console.log("WordSpawner - word positioned at:",s.x,s.y),this.activeWords.push(s),this.container.addChild(s)}getSpawnPosition(e){return g.getCurrentLevel()===2&&e.author==="асель"?{x:o.SPEAKER_X,y:o.SPEAKER_Y}:{x:o.WORD_SPAWN_X,y:this.getRandomSpawnY()}}spawnPlayerMessage(e){const t=this.getSpeedForDifficulty(),i=new Q(e,t);return i.x=o.PLAYER_MESSAGE_SPAWN_X,i.y=o.PLAYER_MESSAGE_SPAWN_Y,i.setDirection(1),console.log("WordSpawner - spawning player message:",e,"at:",i.x,i.y),this.activeWords.push(i),this.container.addChild(i),i}getRandomSpawnY(){const{min:e,max:t}=o.WORD_SPAWN_Y_RANGE;return Math.random()*(t-e)+e}updateWords(e){this.activeWords.forEach(t=>{t.update(e),t.hasReachedEdge&&this.onWordReachedEdge&&this.onWordReachedEdge(t),t.isCompleted&&this.onWordCompleted&&this.onWordCompleted(t)})}cleanupWords(){this.activeWords=this.activeWords.filter(e=>e.isCompleted||e.hasReachedEdge?(console.log("WordSpawner - removing word:",e.targetText,"completed:",e.isCompleted,"reachedEdge:",e.hasReachedEdge,"position:",e.x),e.destroy(),!1):!0),this.remainingMessages.length===0&&this.activeWords.length===0&&this.handleLevelComplete()}getSpeedForDifficulty(){switch(this.currentDifficulty){case"easy":return o.DIFFICULTY_LEVELS.EASY.wordSpeed;case"medium":return o.DIFFICULTY_LEVELS.MEDIUM.wordSpeed;case"hard":return o.DIFFICULTY_LEVELS.HARD.wordSpeed;default:return o.WORD_SPEED}}setDifficulty(e){this.currentDifficulty=e;const t=o.DIFFICULTY_LEVELS[e.toUpperCase()];this.spawnInterval=t.spawnInterval}getActiveWords(){return[...this.activeWords]}findMatchingWord(e){for(const t of this.activeWords)if(t.matchesInput(e)&&!t.isCompleted)return t;return null}getActiveWord(){return this.activeWords.find(e=>e.isActive)||null}setActiveWord(e){this.activeWords.forEach(t=>{t.setActive(!1)}),e&&e.setActive(!0)}typeCharacter(e){const t=this.getActiveWord();return t?t.typeCharacter(e):!1}startSpawning(){console.log("WordSpawner - startSpawning called",{remainingMessages:this.remainingMessages.length,totalMessages:this.totalMessages,currentLevel:g.getCurrentLevel()}),this.isSpawning=!0,this.spawnTimer=0}stopSpawning(){this.isSpawning=!1}clearAllWords(){this.activeWords.forEach(e=>{e.destroy()}),this.activeWords=[]}setMaxWords(e){this.maxWords=e}setSpawnInterval(e){this.spawnInterval=e}getWordCount(){return this.activeWords.length}spawnSpecificWord(e,t){const i=this.getSpeedForDifficulty(),s=new Q(e,i,t||"Mentor");return s.x=o.WORD_SPAWN_X,s.y=this.getRandomSpawnY(),this.activeWords.push(s),this.container.addChild(s),s}initializeLevel(){const e=g.getCurrentLevel();if(e===1||e===2){const i=[...st.getMessagesByLevel(e)].sort(()=>Math.random()-.5);this.remainingMessages=i.slice(0,5),this.totalMessages=this.remainingMessages.length,console.log("WordSpawner - initialized level",e,"with messages:",this.remainingMessages.map(s=>s.text))}else e===3?(this.remainingMessages=[],this.totalMessages=0):(this.remainingMessages=[],this.totalMessages=0);g.setLevelProgress(0)}updateLevelProgress(){const t=(this.totalMessages-this.remainingMessages.length)/this.totalMessages*100;g.setLevelProgress(t)}handleLevelComplete(){const e=g.getCurrentLevel();if(console.log("WordSpawner - handleLevelComplete, currentLevel:",e),e<3){const t=e+1;console.log("WordSpawner - transitioning to nextLevel:",t),g.startLevelTransition(t),this.onLevelAdvance&&this.onLevelAdvance(t)}}resetForLevel(){this.clearAllWords(),this.initializeLevel(),this.spawnTimer=0}getRemainingMessageCount(){return this.remainingMessages.length}getTotalMessageCount(){return this.totalMessages}destroy(){this.clearAllWords()}}let ne=class extends p{constructor(){super();r(this,"increments",[]);r(this,"background");r(this,"levelSeparators",[]);r(this,"PROGRESS_BAR_WIDTH",800);r(this,"PROGRESS_BAR_HEIGHT",20);r(this,"INCREMENT_COUNT",100);r(this,"INCREMENT_WIDTH",this.PROGRESS_BAR_WIDTH/this.INCREMENT_COUNT);r(this,"INCREMENT_GAP",1);r(this,"LEVEL_BOUNDARIES",[.3,.7,1]);this.createBackground(),this.createIncrements(),this.createLevelSeparators(),this.updateProgress(1,0,1)}createBackground(){this.background=new v,this.background.rect(-this.PROGRESS_BAR_WIDTH/2,-this.PROGRESS_BAR_HEIGHT/2,this.PROGRESS_BAR_WIDTH,this.PROGRESS_BAR_HEIGHT),this.background.fill(3355443),this.background.stroke({color:6710886,width:2}),this.addChild(this.background)}createIncrements(){for(let t=0;t<this.INCREMENT_COUNT;t++){const i=new v,s=-this.PROGRESS_BAR_WIDTH/2+t*this.INCREMENT_WIDTH+this.INCREMENT_GAP,n=this.INCREMENT_WIDTH-this.INCREMENT_GAP*2,l=-this.PROGRESS_BAR_HEIGHT/2+this.INCREMENT_GAP,h=this.PROGRESS_BAR_HEIGHT-this.INCREMENT_GAP*2;i.rect(s,l,n,h);const d=t/this.INCREMENT_COUNT;let c=43520;d>=.3&&d<.7&&(c=35071),d>=.7&&(c=16737792),i.fill(c),i.alpha=.2,this.increments.push(i),this.addChild(i)}}createLevelSeparators(){for(let t=0;t<this.LEVEL_BOUNDARIES.length-1;t++){const i=new v,s=-this.PROGRESS_BAR_WIDTH/2+this.LEVEL_BOUNDARIES[t]*this.PROGRESS_BAR_WIDTH;i.rect(s-1,-this.PROGRESS_BAR_HEIGHT/2,2,this.PROGRESS_BAR_HEIGHT),i.fill(16777215),i.alpha=.8,this.levelSeparators.push(i),this.addChild(i)}}updateProgress(t,i,s){const n=s-i;this.updateProgressByItems(t,n,s)}updateProgressWithTypingProgress(t,i,s){this.updateProgressByItems(3,i,s)}updateProgressByItems(t,i,s){let n=0,l=0;t===1?(n=0,l=.3):t===2?(n=.3,l=.7):t===3&&(n=.7,l=1);const h=s>0?i/s:0,d=n+h*(l-n);this.updateIncrementVisuals(d)}updateIncrementVisuals(t){const i=Math.floor(t*this.INCREMENT_COUNT);for(let s=0;s<this.INCREMENT_COUNT;s++){const n=this.increments[s];if(s<i)n.alpha=1;else if(s===i){const l=t*this.INCREMENT_COUNT%1;n.alpha=.2+.8*l}else n.alpha=.2}}getProgress(){let t=0;for(const i of this.increments)i.alpha>.5&&t++;return t/this.INCREMENT_COUNT}reset(){for(const t of this.increments)t.alpha=.2}resize(t,i){this.x=t*.5,this.y=i-50}getIncrementCount(){return this.INCREMENT_COUNT}getCurrentLevelFromProgress(){const t=this.getProgress();return t<.3?1:t<.7?2:3}show(){this.alpha=0;const t=()=>{this.alpha=Math.min(1,this.alpha+.05),this.alpha<1&&requestAnimationFrame(t)};t()}hide(){const t=()=>{this.alpha=Math.max(0,this.alpha-.05),this.alpha>0&&requestAnimationFrame(t)};t()}};var tt={},W={},lt;function G(){if(lt)return W;lt=1,Object.defineProperty(W,"__esModule",{value:!0}),W.Collector=void 0;let a=class{constructor(t){this.emit=(...i)=>{t.emitCollecting(this,i)}}};return W.Collector=a,W}var I={},ht;function ae(){if(ht)return I;ht=1,Object.defineProperty(I,"__esModule",{value:!0}),I.CollectorArray=void 0;const a=G();let e=class extends a.Collector{constructor(){super(...arguments),this.result=[]}handleResult(i){return this.result.push(i),!0}getResult(){return this.result}reset(){this.result.length=0}};return I.CollectorArray=e,I}var R={},ot;function le(){if(ot)return R;ot=1,Object.defineProperty(R,"__esModule",{value:!0}),R.CollectorLast=void 0;const a=G();let e=class extends a.Collector{handleResult(i){return this.result=i,!0}getResult(){return this.result}reset(){delete this.result}};return R.CollectorLast=e,R}var k={},dt;function he(){if(dt)return k;dt=1,Object.defineProperty(k,"__esModule",{value:!0}),k.CollectorUntil0=void 0;const a=G();let e=class extends a.Collector{constructor(){super(...arguments),this.result=!1}handleResult(i){return this.result=i,this.result}getResult(){return this.result}reset(){this.result=!1}};return k.CollectorUntil0=e,k}var H={},ut;function oe(){if(ut)return H;ut=1,Object.defineProperty(H,"__esModule",{value:!0}),H.CollectorWhile0=void 0;const a=G();let e=class extends a.Collector{constructor(){super(...arguments),this.result=!1}handleResult(i){return this.result=i,!this.result}getResult(){return this.result}reset(){this.result=!1}};return H.CollectorWhile0=e,H}var A={},O={},ct;function de(){if(ct)return O;ct=1,Object.defineProperty(O,"__esModule",{value:!0}),O.SignalConnectionImpl=void 0;class a{constructor(t,i){this.link=t,this.parentCleanup=i}disconnect(){return this.link!==null?(this.link.unlink(),this.link=null,this.parentCleanup(),this.parentCleanup=null,!0):!1}set enabled(t){this.link&&this.link.setEnabled(t)}get enabled(){return this.link!==null&&this.link.isEnabled()}}return O.SignalConnectionImpl=a,O}var F={},pt;function ue(){if(pt)return F;pt=1,Object.defineProperty(F,"__esModule",{value:!0}),F.SignalLink=void 0;let a=class Lt{constructor(t=null,i=null,s=0){this.enabled=!0,this.newLink=!1,this.callback=null,this.prev=t??this,this.next=i??this,this.order=s}isEnabled(){return this.enabled&&!this.newLink}setEnabled(t){this.enabled=t}unlink(){this.callback=null,this.next.prev=this.prev,this.prev.next=this.next}insert(t,i){let s=this.prev;for(;s!==this&&!(s.order<=i);)s=s.prev;const n=new Lt(s,s.next,i);return n.callback=t,s.next=n,n.next.prev=n,n}};return F.SignalLink=a,F}var gt;function ce(){if(gt)return A;gt=1,Object.defineProperty(A,"__esModule",{value:!0}),A.Signal=void 0;const a=de(),e=ue();let t=class{constructor(){this.head=new e.SignalLink,this.hasNewLinks=!1,this.emitDepth=0,this.connectionsCount=0}getConnectionsCount(){return this.connectionsCount}hasConnections(){return this.connectionsCount>0}connect(s,n=0){this.connectionsCount++;const l=this.head.insert(s,n);return this.emitDepth>0&&(this.hasNewLinks=!0,l.newLink=!0),new a.SignalConnectionImpl(l,()=>this.decrementConnectionCount())}decrementConnectionCount(){this.connectionsCount--}disconnect(s){for(let n=this.head.next;n!==this.head;n=n.next)if(n.callback===s)return this.decrementConnectionCount(),n.unlink(),!0;return!1}disconnectAll(){for(;this.head.next!==this.head;)this.head.next.unlink();this.connectionsCount=0}emit(...s){this.emitDepth++;for(let n=this.head.next;n!==this.head;n=n.next)n.isEnabled()&&n.callback&&n.callback.apply(null,s);this.emitDepth--,this.unsetNewLink()}emitCollecting(s,n){this.emitDepth++;for(let l=this.head.next;l!==this.head;l=l.next)if(l.isEnabled()&&l.callback){const h=l.callback.apply(null,n);if(!s.handleResult(h))break}this.emitDepth--,this.unsetNewLink()}unsetNewLink(){if(this.hasNewLinks&&this.emitDepth===0){for(let s=this.head.next;s!==this.head;s=s.next)s.newLink=!1;this.hasNewLinks=!1}}};return A.Signal=t,A}var N={},ft;function pe(){if(ft)return N;ft=1,Object.defineProperty(N,"__esModule",{value:!0}),N.SignalConnections=void 0;let a=class{constructor(){this.list=[]}add(t){this.list.push(t)}disconnectAll(){for(const t of this.list)t.disconnect();this.list=[]}getCount(){return this.list.length}isEmpty(){return this.list.length===0}};return N.SignalConnections=a,N}var mt;function ge(){return mt||(mt=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.SignalConnections=a.Signal=a.CollectorWhile0=a.CollectorUntil0=a.CollectorLast=a.CollectorArray=a.Collector=void 0;var e=G();Object.defineProperty(a,"Collector",{enumerable:!0,get:function(){return e.Collector}});var t=ae();Object.defineProperty(a,"CollectorArray",{enumerable:!0,get:function(){return t.CollectorArray}});var i=le();Object.defineProperty(a,"CollectorLast",{enumerable:!0,get:function(){return i.CollectorLast}});var s=he();Object.defineProperty(a,"CollectorUntil0",{enumerable:!0,get:function(){return s.CollectorUntil0}});var n=oe();Object.defineProperty(a,"CollectorWhile0",{enumerable:!0,get:function(){return n.CollectorWhile0}});var l=ce();Object.defineProperty(a,"Signal",{enumerable:!0,get:function(){return l.Signal}});var h=pe();Object.defineProperty(a,"SignalConnections",{enumerable:!0,get:function(){return h.SignalConnections}})}(tt)),tt}var yt=ge();function Y(a){return typeof a=="string"?w.from(a):a instanceof y?new w(a):a}var fe=Object.defineProperty,me=(a,e,t)=>e in a?fe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,P=(a,e,t)=>me(a,typeof e!="symbol"?e+"":e,t);class ye extends p{constructor(e){super(),P(this,"bg"),P(this,"fill"),P(this,"fillMask"),P(this,"progressStart",0),P(this,"_progress",0),P(this,"options"),P(this,"innerView"),P(this,"_view"),this.options=e,this.innerView=new p,this.addChild(this.innerView),e!=null&&e.bg&&(e!=null&&e.fill)&&this.init(e)}init({bg:e,fill:t,fillPaddings:i,progress:s}){this.setBackground(e),this.setFill(t,i),this.progress=s}setBackground(e){var t;this.bg&&this.bg.destroy(),(t=this.options)!=null&&t.nineSliceSprite&&(typeof e=="string"?this.bg=new U({texture:y.from(e),leftWidth:this.options.nineSliceSprite.bg[0],topHeight:this.options.nineSliceSprite.bg[1],rightWidth:this.options.nineSliceSprite.bg[2],bottomHeight:this.options.nineSliceSprite.bg[3]}):e instanceof y?this.bg=new U({texture:e,leftWidth:this.options.nineSliceSprite.bg[0],topHeight:this.options.nineSliceSprite.bg[1],rightWidth:this.options.nineSliceSprite.bg[2],bottomHeight:this.options.nineSliceSprite.bg[3]}):console.warn(`NineSliceSprite can not be used with views set as Container.
                    Pass the texture or texture name as instead of the Container extended instance.`)),this.bg||(this.bg=Y(e)),this.innerView.addChildAt(this.bg,0)}setFill(e,t){var b;if(this.fill&&this.fill.destroy(),this.bg instanceof w&&e===this.bg){console.warn("Can not use same Sprite instance for bg and fill.");return}(b=this.options)!=null&&b.nineSliceSprite?typeof e=="string"||e instanceof y?this.fill=new U({texture:typeof e=="string"?y.from(e):e,leftWidth:this.options.nineSliceSprite.fill[0],topHeight:this.options.nineSliceSprite.fill[1],rightWidth:this.options.nineSliceSprite.fill[2],bottomHeight:this.options.nineSliceSprite.fill[3]}):(console.warn(`NineSliceSprite can not be used with views set as Container.
                    Pass the texture or texture name as instead of the Container extended instance.`),this.fill=Y(e)):this.fill=Y(e),this.innerView.addChildAt(this.fill,1);const i=(t==null?void 0:t.left)??0,s=(t==null?void 0:t.top)??0;this.fill.x=i,this.fill.y=s,this.fillMask&&(this.fill.mask=null,this.fillMask.destroy());const n=this.fill.width/2,l=this.fill.width/2,h=this.fill.height/2,d=this.fill.height/2;let c=y.WHITE;this.fill instanceof w&&this.fill.texture&&(c=this.fill.texture),this.fillMask=new U({texture:c,leftWidth:n,topHeight:h,rightWidth:l,bottomHeight:d}),this.fillMask.position.copyFrom(this.fill),this.addChild(this.fillMask),this.fill.mask=this.fillMask}validate(e){return e=Math.round(e),e<0?0:e>100?100:e}set progress(e){this._progress=this.validate(e),this.fill&&this.fillMask&&(this.fill.mask=null,this.fillMask.width=this.fill.width/100*(this._progress-this.progressStart),this.fillMask.x=this.progressStart/100*this.fill.width+this.fill.x,this.fillMask.height=this.fill.height,this.fill.mask=this.fillMask)}get progress(){return this._progress}set width(e){var t,i,s;if((t=this.options)!=null&&t.nineSliceSprite){if(this.bg&&(this.bg.width=e),this.fill){const n=((i=this.options.fillPaddings)==null?void 0:i.left)??0,l=((s=this.options.fillPaddings)==null?void 0:s.right)??0;this.fill.width=e-n-l,this.fillMask.width=e-n-l}this.progress=this._progress}else super.width=e}get width(){return super.width}set height(e){var t,i,s;if((t=this.options)!=null&&t.nineSliceSprite){if(this.bg&&(this.bg.height=e),this.fill){const n=((i=this.options.fillPaddings)==null?void 0:i.top)??0,l=((s=this.options.fillPaddings)==null?void 0:s.bottom)??0;this.fill.height=e-n-l,this.fillMask.height=e-n-l}this.progress=this._progress}else super.height=e}get height(){return super.height}setSize(e,t){var i,s,n,l,h;if((i=this.options)!=null&&i.nineSliceSprite){if(this.bg&&this.bg.setSize(e,t),this.fill){typeof e=="object"?(t=e.height??e.width,e=e.width):t=t??e;const d=((s=this.options.fillPaddings)==null?void 0:s.top)??0,c=((n=this.options.fillPaddings)==null?void 0:n.bottom)??0,b=((l=this.options.fillPaddings)==null?void 0:l.left)??0,f=((h=this.options.fillPaddings)==null?void 0:h.right)??0;this.fill.setSize(e-b-f,t-d-c),this.fillMask.setSize(e-b-f,t-d-c)}this.progress=this._progress}else super.setSize(e,t)}}var xe=Object.defineProperty,be=(a,e,t)=>e in a?xe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,C=(a,e,t)=>be(a,typeof e!="symbol"?e+"":e,t);class Se extends ye{constructor(e){super(e),C(this,"_slider1"),C(this,"_slider2"),C(this,"value1Text"),C(this,"value2Text"),C(this,"_value1"),C(this,"_value2"),C(this,"dragging",0),C(this,"_min",0),C(this,"_max",100),C(this,"_step",1),C(this,"startX"),C(this,"startUpdateValue1"),C(this,"startUpdateValue2"),C(this,"settings"),this.settings=e,this.slider1=e.slider1,this.slider2=e.slider2,this.min=e.min??0,this.max=e.max??100}init(e){super.init(e),this.fill&&(this.fill.eventMode="none")}set slider1(e){if(e&&(this._slider1&&(this.slider1.removeAllListeners(),this.slider1.destroy()),this._slider1=this.createSlider(e),this.settings.showValue&&!this.value1Text)){const t=this.settings.valueTextClass??L;this.value1Text=new t({text:"",style:this.settings.valueTextStyle||{fill:16777215}}),this.value1Text.anchor.set(.5),this.addChild(this.value1Text)}}get slider1(){return this._slider1}set slider2(e){if(e&&(this._slider2&&(this.slider2.removeAllListeners(),this.slider2.destroy()),this._slider2=this.createSlider(e),this.settings.showValue&&!this.value2Text)){const t=this.settings.valueTextClass??L;this.value2Text=new t({text:"",style:this.settings.valueTextStyle||{fill:16777215}}),this.value2Text.anchor.set(.5),this.addChild(this.value2Text)}}get slider2(){return this._slider2}setBackground(e){this.bg&&this.bg.removeAllListeners(),super.setBackground(e),this.activateBG()}activateBG(){this.bg.eventMode="static",this.bg.on("pointerdown",this.startUpdate,this).on("globalpointermove",this.update,this).on("pointerup",this.endUpdate,this).on("pointerupoutside",this.endUpdate,this)}createSlider(e){var n,l;const t=Y(e),i=h=>{this.bg&&(h.currentTarget=this.bg),this.startUpdate(h)};t.eventMode="static",t.on("pointerdown",i).on("pointerup",this.endUpdate,this).on("pointerupoutside",this.endUpdate,this),t.x=t.width/2;const s=new p;return s.addChild(t),t instanceof w&&t.anchor.set(.5),s.y=(n=this.bg)!=null&&n.height?((l=this.bg)==null?void 0:l.height)/2:0,this.addChild(s),s}startUpdate(e){this.dragging=1;const t=e.currentTarget;this.startX=t.parent.worldTransform.applyInverse(e.global).x,this.startUpdateValue1=this._value1,this.startUpdateValue2=this._value2,this.update(e)}endUpdate(){this.dragging&&(this.dragging=0,(this.startX||this.startUpdateValue1!==this._value1||this.startUpdateValue2!==this._value2)&&this.change(),this.startUpdateValue1=null,this.startUpdateValue2=null)}onClick(){this.change()}update(e){const t=e.currentTarget,{x:i}=t.parent.worldTransform.applyInverse(e.global);i!==this.startX&&(this.startX=null)}change(){}set max(e){this._max=e}get max(){return this._max}set min(e){this._min=e}get min(){return this._min}set step(e){this._step=e}get step(){return this._step}}var ve=Object.defineProperty,Ce=(a,e,t)=>e in a?ve(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,z=(a,e,t)=>Ce(a,typeof e!="symbol"?e+"":e,t);class we extends p{constructor(e){var t;super(),z(this,"options"),z(this,"view"),z(this,"_type"),z(this,"_maxWidth"),z(this,"children",[]),e&&(e.maxWidth&&(this._maxWidth=e.maxWidth),this.init(e)),(t=e==null?void 0:e.items)==null||t.forEach(i=>this.addChild(i)),this.on("added",()=>this.arrangeChildren()),this.on("childAdded",()=>this.arrangeChildren())}init(e){this.options=e,e!=null&&e.type&&(this.type=e.type),e!=null&&e.children&&e.children.forEach(t=>this.addChild(t))}set type(e){this._type=e,this.arrangeChildren()}get type(){return this._type}set elementsMargin(e){if(!this.options)throw new Error("List has not been initiated!");this.options.elementsMargin=e,this.arrangeChildren()}get elementsMargin(){var e;return((e=this.options)==null?void 0:e.elementsMargin)??0}set padding(e){if(!this.options)throw new Error("List has not been initiated!");this.options.padding=e,this.options.vertPadding=e,this.options.horPadding=e,this.options.leftPadding=e,this.options.rightPadding=e,this.options.topPadding=e,this.options.bottomPadding=e,this.arrangeChildren()}get padding(){var e;return((e=this.options)==null?void 0:e.padding)??0}set vertPadding(e){if(!this.options)throw new Error("List has not been initiated!");this.options.vertPadding=e,this.options.topPadding=e,this.options.bottomPadding=e,this.arrangeChildren()}get vertPadding(){var e;return((e=this.options)==null?void 0:e.vertPadding)??this.padding??0}set horPadding(e){if(!this.options)throw new Error("List has not been initiated!");this.options.horPadding=e,this.options.leftPadding=e,this.options.rightPadding=e,this.arrangeChildren()}get horPadding(){var e;return((e=this.options)==null?void 0:e.horPadding)??this.padding??0}set leftPadding(e){if(!this.options)throw new Error("List has not been initiated!");this.options.leftPadding=e,this.arrangeChildren()}get leftPadding(){var e;return((e=this.options)==null?void 0:e.leftPadding)??this.horPadding}set rightPadding(e){if(!this.options)throw new Error("List has not been initiated!");this.options.rightPadding=e,this.arrangeChildren()}get rightPadding(){var e;return((e=this.options)==null?void 0:e.rightPadding)??this.horPadding}set topPadding(e){if(!this.options)throw new Error("List has not been initiated!");this.options.topPadding=e,this.arrangeChildren()}get topPadding(){var e;return((e=this.options)==null?void 0:e.topPadding)??this.vertPadding}set bottomPadding(e){if(!this.options)throw new Error("List has not been initiated!");this.options.bottomPadding=e,this.arrangeChildren()}get bottomPadding(){var e;return((e=this.options)==null?void 0:e.bottomPadding)??this.vertPadding}arrangeChildren(){var l,h;let e=0,t=this.leftPadding,i=this.topPadding;const s=((l=this.options)==null?void 0:l.elementsMargin)??0;let n=this.maxWidth??((h=this.parent)==null?void 0:h.width);this.rightPadding&&(n-=this.rightPadding),this.children.forEach((d,c)=>{switch(this.type){case"vertical":d.y=i,d.x=t,i+=s+d.height;break;case"horizontal":d.x=t,d.y=i,t+=s+d.width;break;case"bidirectional":default:d.x=t,d.y=i,d.x+d.width>n&&c>0&&(i+=s+e,t=this.leftPadding,d.x=t,d.y=i,e=0),e=Math.max(e,d.height),t+=s+d.width;break}})}removeItem(e){const t=this.children[e];t&&(this.removeChild(t),this.arrangeChildren())}set maxWidth(e){this._maxWidth=e,this.arrangeChildren()}get maxWidth(){return this._maxWidth}}var Te=Object.defineProperty,Pe=(a,e,t)=>e in a?Te(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,et=(a,e,t)=>Pe(a,typeof e!="symbol"?e+"":e,t);class Le extends Se{constructor(e){super({slider1:e.slider,value1:e.value,...e}),et(this,"sliderOptions"),et(this,"onUpdate",new yt.Signal),et(this,"onChange",new yt.Signal),this.sliderOptions=e,this.step=e.step||1,this.value=e.value??this.min,this.updateSlider()}get value(){return this._value1}set value(e){var t;e!==this._value1&&(e<this.min&&(e=this.min),e>this.max&&(e=this.max),this._value1=e,this.updateSlider(),(t=this.onUpdate)==null||t.emit(this.value))}set max(e){super.max=e,this.updateSlider()}get max(){return super.max}set min(e){super.min=e,this.updateSlider()}get min(){return super.min}set step(e){super.step=e,this.updateSlider()}get step(){return super.step}set slider(e){this.slider1=e,this.updateSlider()}update(e){var l;if(super.update(e),!this.dragging)return;const t=e.currentTarget,{x:i}=t.parent.worldTransform.applyInverse(e.global),s=i/(((l=this.bg)==null?void 0:l.width)||1),n=this.min+s*(this.max-this.min);this.value=Math.round(n/this.step)*this.step}change(){var e;(e=this.onChange)==null||e.emit(this.value)}updateSlider(){var e,t,i,s,n;if(this.progress=((this.value??this.min)-this.min)/(this.max-this.min)*100,this._slider1.x=((e=this.bg)==null?void 0:e.width)/100*this.progress-this._slider1.width/2,this._slider1.y=((t=this.bg)==null?void 0:t.height)/2,(i=this.sliderOptions)!=null&&i.showValue){this.value1Text.text=`${Math.round(this.value)}`;const l=this._slider1.x+this._slider1.width/2,h=this._slider1.y;this.value1Text.x=l+(((s=this.sliderOptions.valueTextOffset)==null?void 0:s.x)??0),this.value1Text.y=h+(((n=this.sliderOptions.valueTextOffset)==null?void 0:n.y)??0)}}set width(e){super.width=e,this.updateSlider()}get width(){return super.width}set height(e){super.height=e,this.updateSlider()}get height(){return super.height}setSize(e,t){super.setSize(e,t),this.updateSlider()}}class it extends Le{constructor(t,i=-.1,s=100,n=100){const Mt=new v().roundRect(0,0,280,10,5).fill({color:1118481}).roundRect(1,1,278,8,5).fill({color:16777215}),Et=new v().roundRect(0,0,280,10,5).fill({color:1118481}).roundRect(1,1,280-1*2,10-1*2,5).fill({color:1118481}),Dt=new v().circle(0,0,9).fill({color:1118481});super({bg:Mt,fill:Et,slider:Dt,min:i,max:s});r(this,"messageLabel");this.value=n,this.messageLabel=new m({text:t,style:{align:"left",fill:1118481,fontSize:18}}),this.messageLabel.anchor.x=0,this.messageLabel.x=10,this.messageLabel.y=-18,this.addChild(this.messageLabel)}}class _e extends p{constructor(){super();r(this,"bg");r(this,"panel");r(this,"title");r(this,"doneButton");r(this,"panelBase");r(this,"versionLabel");r(this,"layout");r(this,"masterSlider");r(this,"bgmSlider");r(this,"sfxSlider");this.bg=new w(y.WHITE),this.bg.tint=0,this.bg.interactive=!0,this.addChild(this.bg),this.panel=new p,this.addChild(this.panel),this.panelBase=new $({height:425}),this.panel.addChild(this.panelBase),this.title=new L({text:"SETTINGS",style:{fontSize:50,fill:1118481,fontWeight:"bold",align:"center"}}),this.title.anchor.set(.5),this.title.y=-this.panelBase.boxHeight*.5+60,this.panel.addChild(this.title),this.doneButton=new L({text:"🆗",style:{fontSize:80,fill:1118481,fontWeight:"bold",align:"center"}}),this.doneButton.anchor.set(.5),this.doneButton.y=this.panelBase.boxHeight*.5-78,this.doneButton.eventMode="static",this.doneButton.cursor="pointer",this.doneButton.on("pointerup",()=>x().navigation.dismissPopup()),this.panel.addChild(this.doneButton),this.versionLabel=new m({text:"Version 0.0.0",style:{fill:1118481,fontSize:12}}),this.versionLabel.alpha=.5,this.versionLabel.y=this.panelBase.boxHeight*.5-15,this.panel.addChild(this.versionLabel),this.layout=new we({type:"vertical",elementsMargin:4}),this.layout.x=-140,this.layout.y=-80,this.panel.addChild(this.layout),this.masterSlider=new it("Master Volume"),this.masterSlider.onUpdate.connect(t=>{B.setMasterVolume(t/100)}),this.layout.addChild(this.masterSlider),this.bgmSlider=new it("BGM Volume"),this.bgmSlider.onUpdate.connect(t=>{B.setBgmVolume(t/100)}),this.layout.addChild(this.bgmSlider),this.sfxSlider=new it("SFX Volume"),this.sfxSlider.onUpdate.connect(t=>{B.setSfxVolume(t/100)}),this.layout.addChild(this.sfxSlider)}resize(t,i){this.bg.width=t,this.bg.height=i,this.panel.x=t*.5,this.panel.y=i*.5}prepare(){this.masterSlider.value=B.getMasterVolume()*100,this.bgmSlider.value=B.getBgmVolume()*100,this.sfxSlider.value=B.getSfxVolume()*100}async show(){const t=x();t.navigation.currentScreen&&(t.navigation.currentScreen.filters=[new q({strength:4})]),this.bg.alpha=0,this.panel.pivot.y=-400,u(this.bg,{alpha:.8},{duration:.2,ease:"linear"}),await u(this.panel.pivot,{y:0},{duration:.3,ease:"backOut"})}async hide(){const t=x();t.navigation.currentScreen&&(t.navigation.currentScreen.filters=[]),u(this.bg,{alpha:0},{duration:.2,ease:"linear"}),await u(this.panel.pivot,{y:-500},{duration:.3,ease:"backIn"})}}class Be extends p{constructor(){super();r(this,"background");r(this,"elements");r(this,"stopButton");r(this,"settingsButton");r(this,"scoreDisplay");r(this,"livesDisplay");r(this,"levelDisplay");r(this,"progressDisplay");this.background=new v,this.background.fill({color:3355443,alpha:.9}),this.background.roundRect(0,0,800,60,10),this.addChild(this.background),this.elements=new p,this.addChild(this.elements),this.createUIElements()}createUIElements(){let i=20;this.stopButton=new m({text:"⏸️",style:{fontFamily:o.FONT_FAMILY,fontSize:40,fill:16729156}}),this.stopButton.x=i,this.stopButton.y=24,this.stopButton.interactive=!0,this.stopButton.on("pointerdown",()=>{x().navigation.presentPopup(Pt)}),this.elements.addChild(this.stopButton),i+=this.stopButton.width+20,this.scoreDisplay=new m({text:"Score: 0",style:{fontFamily:o.FONT_FAMILY,fontSize:16,fill:16777215}}),this.scoreDisplay.x=i,this.scoreDisplay.y=20,this.elements.addChild(this.scoreDisplay),i+=this.scoreDisplay.width+20,this.livesDisplay=new m({text:"Lives: 3",style:{fontFamily:o.FONT_FAMILY,fontSize:16,fill:16711680}}),this.livesDisplay.x=i,this.livesDisplay.y=20,this.elements.addChild(this.livesDisplay),i+=this.livesDisplay.width+20,this.levelDisplay=new m({text:"Level: 1",style:{fontFamily:o.FONT_FAMILY,fontSize:16,fill:4491519}}),this.levelDisplay.x=i,this.levelDisplay.y=20,this.elements.addChild(this.levelDisplay),i+=this.levelDisplay.width+20,this.progressDisplay=new m({text:"Progress: 0%",style:{fontFamily:o.FONT_FAMILY,fontSize:16,fill:13421772}}),this.progressDisplay.x=i,this.progressDisplay.y=20,this.elements.addChild(this.progressDisplay),this.settingsButton=new m({text:"⚙️",style:{fontFamily:o.FONT_FAMILY,fontSize:40,fill:16777215}}),this.settingsButton.y=24,this.settingsButton.interactive=!0,this.settingsButton.on("pointerdown",()=>{x().navigation.presentPopup(_e)}),this.elements.addChild(this.settingsButton)}updateScore(t){this.scoreDisplay.text=`Score: ${t}`}updateLives(t){this.livesDisplay.text=`Lives: ${t}`}updateLevel(t){this.levelDisplay.text=`Level: ${t}`}updateProgress(t){this.progressDisplay.text=`Progress: ${Math.round(t)}%`}resize(t){this.background.clear(),this.background.fill({color:3355443,alpha:.9}),this.background.roundRect(0,0,t,60,10);const i=20;this.settingsButton.x=t-this.settingsButton.width-i}}class Me extends p{constructor(){super();r(this,"fullText","");r(this,"typedText","");r(this,"textDisplay");r(this,"hasWrongCharacter",!1);r(this,"background");this.background=new p,this.addChild(this.background),this.textDisplay=new Kt({text:"",style:{fontFamily:"Arial",fontSize:24,fill:16777215,wordWrap:!0,wordWrapWidth:800,align:"left"}}),this.textDisplay.anchor.set(0,.5),this.addChild(this.textDisplay),this.updateDisplay()}setText(t){this.fullText=t,this.typedText="",this.hasWrongCharacter=!1,this.updateDisplay()}typeCharacter(t){const i=this.getNextExpectedCharacter();return i&&i.toLowerCase()===t.toLowerCase()?(this.typedText+=i,this.hasWrongCharacter=!1,this.updateDisplay(),!0):(this.hasWrongCharacter=!0,this.updateDisplay(),!1)}backspace(){this.typedText.length>0&&(this.typedText=this.typedText.slice(0,-1),this.hasWrongCharacter=!1,this.updateDisplay())}getNextExpectedCharacter(){return this.typedText.length<this.fullText.length?this.fullText[this.typedText.length]:null}isCurrentWordCompleted(){const t=this.getNextExpectedCharacter();return t===" "||t===null}getCurrentWord(){const t=this.typedText.lastIndexOf(" "),i=t===-1?0:t+1;let s=this.fullText.indexOf(" ",i);return s===-1&&(s=this.fullText.length),this.fullText.slice(i,s)}completeCurrentWord(){if(!this.isCurrentWordCompleted())return null;const t=this.getCurrentWord();return this.getNextExpectedCharacter()===" "&&(this.typedText+=" ",this.updateDisplay()),t}isCompleted(){return this.typedText.length===this.fullText.length}getProgress(){return this.fullText.length===0?1:this.typedText.length/this.fullText.length}updateDisplay(){if(this.fullText.length===0){this.textDisplay.text="";return}const t=this.typedText,i=this.fullText.slice(this.typedText.length);let s="";if(t.length>0&&(s+=`<span style="color: #888888">${this.escapeHtml(t)}</span>`),i.length>0){const n=i[0],l=i.slice(1),h=this.hasWrongCharacter?"#ff0000":"#ffffff";s+=`<span style="color: ${h}">${this.escapeHtml(n)}</span>`,l.length>0&&(s+=`<span style="color: #ffffff">${this.escapeHtml(l)}</span>`)}this.textDisplay.text=s}escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}resize(t,i){this.x=-t*.4,this.y=o.TYPING_TEXT_Y}reset(){this.fullText="",this.typedText="",this.hasWrongCharacter=!1,this.updateDisplay()}getRemainingText(){return this.fullText.slice(this.typedText.length)}getTypedText(){return this.typedText}getFullText(){return this.fullText}}class _t extends p{constructor(){super();r(this,"bg");r(this,"panel");r(this,"panelBase");r(this,"titleLabel");r(this,"captionLabel");r(this,"subtitleLabel");r(this,"scoreLabel");r(this,"inputManager");this.bg=new w(y.WHITE),this.bg.tint=0,this.bg.alpha=.8,this.addChild(this.bg),this.panel=new p,this.addChild(this.panel),this.panelBase=new $({width:500,height:350,color:1710618}),this.panel.addChild(this.panelBase),this.titleLabel=new m({text:"KIIIICK",style:{fontSize:48,fill:16729156,fontWeight:"bold"}}),this.titleLabel.anchor.set(.5),this.titleLabel.y=-100,this.panel.addChild(this.titleLabel),this.captionLabel=new m({text:"minus 200k deposit and minus vibe",style:{fontSize:16,fill:8947848}}),this.captionLabel.anchor.set(.5),this.captionLabel.y=-60,this.panel.addChild(this.captionLabel),this.scoreLabel=new m({text:"Final Score: 0",style:{fontSize:24,fill:16777215}}),this.scoreLabel.anchor.set(.5),this.scoreLabel.y=-10,this.panel.addChild(this.scoreLabel),this.subtitleLabel=new m({text:"Press SPACE to try again",style:{fontSize:18,fill:13421772}}),this.subtitleLabel.anchor.set(.5),this.subtitleLabel.y=120,this.panel.addChild(this.subtitleLabel),this.inputManager=new rt,this.inputManager.onCharacterTyped=this.handleKeyPressed.bind(this),this.inputManager.setEnabled(!1),this.addBlinkingEffect()}addBlinkingEffect(){const t=()=>{u(this.subtitleLabel,{alpha:.3},{duration:.8,ease:"easeInOut"}).then(()=>{u(this.subtitleLabel,{alpha:1},{duration:.8,ease:"easeInOut"}).then(t)})};t()}handleKeyPressed(){}setupSpaceListener(){const t=i=>{(i.code==="Space"||i.key===" ")&&(i.preventDefault(),this.restartGame(),window.removeEventListener("keydown",t))};window.addEventListener("keydown",t)}async restartGame(){this.inputManager.setEnabled(!1),g.reset(),await x().navigation.showScreen(nt)}updateScoreFromGameState(){if(g.hasJustEnded()){const t=g.getFinalScore();this.scoreLabel.text=`Final Score: ${t}`,g.consume()}}prepare(){this.updateScoreFromGameState()}update(){}resize(t,i){this.bg.width=t,this.bg.height=i,this.panel.x=t*.5,this.panel.y=i*.5}async show(){this.inputManager.setEnabled(!0),this.setupSpaceListener(),this.bg.alpha=0,this.panel.scale.set(.5),this.panel.alpha=0,u(this.bg,{alpha:.8},{duration:.3,ease:"easeOut"});const t=u(this.panel,{alpha:1},{duration:.4,ease:"easeOut",delay:.1});await u(this.panel.scale,{x:1,y:1},{duration:.5,ease:"backOut",delay:.1}),await t}async hide(){this.inputManager.setEnabled(!1);const t=u(this.bg,{alpha:0},{duration:.2,ease:"easeIn"}),i=u(this.panel,{alpha:0},{duration:.2,ease:"easeIn"});await Promise.all([t,i])}destroy(){this.inputManager.destroy(),super.destroy()}}r(_t,"assetBundles",["main"]);class Bt extends p{constructor(){super();r(this,"bg");r(this,"panel");r(this,"panelBase");r(this,"titleLabel");r(this,"messageLabel");r(this,"scoreLabel");r(this,"restartLabel");r(this,"inputManager");this.bg=new w(y.WHITE),this.bg.tint=0,this.bg.alpha=.9,this.addChild(this.bg),this.panel=new p,this.addChild(this.panel),this.panelBase=new $({width:700,height:500,color:1710618}),this.panel.addChild(this.panelBase),this.titleLabel=new m({text:"ПОБЕДА!",style:{fontSize:64,fill:65280,fontWeight:"bold"}}),this.titleLabel.anchor.set(.5),this.titleLabel.y=-150,this.panel.addChild(this.titleLabel),this.messageLabel=new m({text:`Поздравляем! Вы успешно завершили инкубатор
и победили финального босса!`,style:{fontSize:24,fill:16777215,wordWrap:!0,wordWrapWidth:600,align:"center"}}),this.messageLabel.anchor.set(.5),this.messageLabel.y=-50,this.panel.addChild(this.messageLabel),this.scoreLabel=new m({text:"Финальный счет: 0",style:{fontSize:28,fill:16776960,fontWeight:"bold"}}),this.scoreLabel.anchor.set(.5),this.scoreLabel.y=50,this.panel.addChild(this.scoreLabel),this.restartLabel=new m({text:"Нажмите SPACE, чтобы начать заново",style:{fontSize:20,fill:13421772}}),this.restartLabel.anchor.set(.5),this.restartLabel.y=150,this.panel.addChild(this.restartLabel),this.inputManager=new rt,this.inputManager.setEnabled(!1),this.addBlinkingEffect()}addBlinkingEffect(){const t=()=>{u(this.restartLabel,{alpha:.3},{duration:.8,ease:"easeInOut"}).then(()=>{u(this.restartLabel,{alpha:1},{duration:.8,ease:"easeInOut"}).then(t)})};t()}setupSpaceListener(){const t=i=>{(i.code==="Space"||i.key===" ")&&(i.preventDefault(),this.restartGame(),window.removeEventListener("keydown",t))};window.addEventListener("keydown",t)}async restartGame(){this.inputManager.setEnabled(!1),g.reset(),await x().navigation.showScreen(nt)}prepare(){const t=g.getFinalScore();this.scoreLabel.text=`Финальный счет: ${t}`}update(){}resize(t,i){this.bg.width=t,this.bg.height=i,this.panel.x=t*.5,this.panel.y=i*.5}async show(){x().audio.bgm.play("main/sounds/bgm-main.mp3",{volume:.3}),this.inputManager.setEnabled(!0),this.setupSpaceListener(),this.bg.alpha=0,this.panel.scale.set(.5),this.panel.alpha=0,u(this.bg,{alpha:.9},{duration:.5,ease:"easeOut"});const t=u(this.panel,{alpha:1},{duration:.6,ease:"easeOut",delay:.2});await u(this.panel.scale,{x:1,y:1},{duration:.8,ease:"backOut",delay:.2}),await t,this.titleLabel.scale.set(.5),await u(this.titleLabel.scale,{x:1.2,y:1.2},{duration:.3,ease:"backOut",delay:.5}),await u(this.titleLabel.scale,{x:1,y:1},{duration:.2,ease:"easeOut"})}async hide(){this.inputManager.setEnabled(!1);const t=u(this.bg,{alpha:0},{duration:.3,ease:"easeIn"}),i=u(this.panel,{alpha:0},{duration:.3,ease:"easeIn"});await Promise.all([t,i])}destroy(){this.inputManager.destroy(),super.destroy()}}r(Bt,"assetBundles",["main"]);class Ee extends p{constructor(){super();r(this,"mainContainer");r(this,"backgroundSprite");r(this,"paused",!1);r(this,"inputManager");r(this,"wordSpawner");r(this,"gameContainer");r(this,"player");r(this,"currentInputDisplay");r(this,"scoreDisplay");r(this,"livesDisplay");r(this,"levelDisplay");r(this,"progressDisplay");r(this,"progressBar");r(this,"typingTextDisplay");r(this,"boss");r(this,"currentBossText","");r(this,"tabBar");r(this,"inputDisplay");r(this,"inputBackground");r(this,"inputText");r(this,"textCursor");r(this,"score",0);r(this,"lives",3);r(this,"currentInput","");r(this,"wrongCharHighlight",!1);r(this,"completedMessages",0);r(this,"totalMessagesInLevel",0);this.backgroundSprite=new w(y.from("background_main.png")),this.backgroundSprite.anchor.set(.5);const t=new q(9);this.backgroundSprite.filters=[t],this.addChild(this.backgroundSprite),this.mainContainer=new p,this.addChild(this.mainContainer),this.initGame(),this.initUI()}initGame(){this.gameContainer=new p,this.mainContainer.addChild(this.gameContainer),this.player=new te,this.mainContainer.addChild(this.player),this.boss=new Zt,this.boss.visible=!1,this.boss.onDefeated=this.handleBossDefeated.bind(this),this.mainContainer.addChild(this.boss),console.log(`Player initialized at: (${this.player.x}, ${this.player.y})`),console.log("MainContainer will be positioned at center during resize"),this.ensurePlayerPosition(),this.inputManager=new rt,this.inputManager.onCharacterTyped=this.handleCharacterTyped.bind(this),this.inputManager.onBackspace=this.handleBackspace.bind(this),this.inputManager.onEscape=this.handleEscape.bind(this),this.wordSpawner=new re(this.gameContainer),this.wordSpawner.onWordReachedEdge=this.handleWordReachedEdge.bind(this),this.wordSpawner.onWordCompleted=this.handleWordCompleted.bind(this),this.wordSpawner.onLevelAdvance=this.handleLevelAdvance.bind(this)}ensurePlayerPosition(){this.player.x=-o.GAME_WIDTH/2+50,this.player.y=400}initUI(){this.tabBar=new Be,this.tabBar.y=20,this.addChild(this.tabBar),this.scoreDisplay=new m({text:`Score: ${this.score}`,style:{fontSize:20,fill:16777215}}),this.scoreDisplay.y=80,this.addChild(this.scoreDisplay),this.livesDisplay=new m({text:`Lives: ${this.lives}`,style:{fontSize:20,fill:16711680}}),this.livesDisplay.y=110,this.addChild(this.livesDisplay),this.levelDisplay=new m({text:`Level: ${g.getCurrentLevel()}`,style:{fontSize:20,fill:4491519}}),this.levelDisplay.y=140,this.addChild(this.levelDisplay),this.progressDisplay=new m({text:"Progress: 0%",style:{fontSize:18,fill:13421772}}),this.progressDisplay.y=170,this.addChild(this.progressDisplay),this.currentInputDisplay=new m({text:"",style:{fontSize:18,fill:65280}}),this.currentInputDisplay.y=200,this.addChild(this.currentInputDisplay),this.progressBar=new ne,this.addChild(this.progressBar),this.typingTextDisplay=new Me,this.typingTextDisplay.visible=!1,this.mainContainer.addChild(this.typingTextDisplay),this.createInputDisplay()}handleCharacterTyped(t){g.getCurrentLevel()===3?this.handleLevel3CharacterTyped(t):this.handleLevel12CharacterTyped(t)}handleLevel12CharacterTyped(t){const i=t.toLowerCase(),s=this.wordSpawner.getActiveWord();if(s&&!s.isCompleted)s.getNextCharacter()===i?(this.currentInput+=i,this.wrongCharHighlight=!1,this.updateInputDisplay(),this.shootBullet(),this.processActiveWordInput(s,i)):(this.wrongCharHighlight=!0,this.updateInputDisplay());else{const n=this.currentInput+i,l=this.wordSpawner.findMatchingWord(n);l&&(this.currentInput+=i,this.wrongCharHighlight=!1,this.updateInputDisplay(),this.wordSpawner.setActiveWord(l),this.player.setTarget(l),this.shootBullet(),this.processActiveWordInput(l,i))}}handleLevel3CharacterTyped(t){t===" "?this.handleLevel3SpacePressed():(this.typingTextDisplay.typeCharacter(t)?this.typingTextDisplay.isCurrentWordCompleted()&&console.log("Level 3 - word completed, waiting for space"):console.log("Level 3 - wrong character:",t),this.updateLevel3InputDisplay())}handleLevel3SpacePressed(){const t=this.typingTextDisplay.completeCurrentWord();t&&(this.wordSpawner.spawnPlayerMessage(t),console.log("Level 3 - sent word:",t),this.typingTextDisplay.isCompleted()&&this.handleLevel3TextCompleted())}handleLevel3TextCompleted(){console.log("Level 3 - boss text completed!")}async handleBossDefeated(){console.log("Boss defeated - showing victory screen!"),this.wordSpawner.stopSpawning(),this.inputManager.setEnabled(!1),g.setFinalScore(this.score),await x().navigation.showScreen(Bt)}updateLevel3InputDisplay(){this.typingTextDisplay.getNextExpectedCharacter();const t=this.typingTextDisplay.getCurrentWord(),i=this.typingTextDisplay.getProgress();let s=`Typing: ${t} | Progress: ${Math.round(i*100)}%`;this.currentInputDisplay.text=s,this.currentInputDisplay.style.fill=65280}handleBackspace(){g.getCurrentLevel()===3?(this.typingTextDisplay.backspace(),this.updateLevel3InputDisplay()):this.currentInput.length>0&&(this.currentInput=this.currentInput.slice(0,-1),this.wrongCharHighlight=!1,this.updateInputDisplay(),this.currentInput.length===0&&(this.wordSpawner.setActiveWord(null),this.player.setTarget(null)))}handleEscape(){this.clearInput()}clearInput(){this.currentInput="",this.wrongCharHighlight=!1,this.updateInputDisplay(),this.wordSpawner.setActiveWord(null),this.player.setTarget(null)}processActiveWordInput(t,i){t.typeCharacter(i)&&t.isCompleted&&this.handleWordCompleted(t)}shootBullet(){const t=this.wordSpawner.getActiveWord();t&&!t.isCompleted&&this.player.shootBullet()}createInputDisplay(){this.inputDisplay=new p,this.addChild(this.inputDisplay),this.inputBackground=new v().roundRect(0,0,400,50,8).fill({color:16777215}),this.inputDisplay.addChild(this.inputBackground),this.inputText=new L({text:"Type here...",style:{fontFamily:o.FONT_FAMILY,fontSize:18,fill:0}}),this.inputText.x=15,this.inputText.y=15,this.inputDisplay.addChild(this.inputText),this.textCursor=new v().rect(0,0,2,20).fill({color:0}),this.textCursor.x=15,this.textCursor.y=15,this.inputDisplay.addChild(this.textCursor),this.startCursorBlink()}startCursorBlink(){let t=!0;setInterval(()=>{this.textCursor.visible=t,t=!t},500)}updateInputDisplay(){let t=this.currentInput||"Type here...";if(this.wrongCharHighlight){const i=this.wordSpawner.getActiveWord();if(i){const s=i.getNextCharacter();t+=` (Expected: ${s})`}}this.inputText.text=t,this.textCursor.x=15+this.inputText.width}async handleWordReachedEdge(){this.lives--,this.updateLivesDisplay(),this.lives<=0&&await this.gameOver()}handleWordCompleted(t){this.score+=t.targetText.length*10,this.updateScoreDisplay(),this.completedMessages++,this.clearInput()}async handleLevelAdvance(){this.wordSpawner.stopSpawning(),this.inputManager.setEnabled(!1),this.clearInput(),await x().navigation.showScreen(nt)}updateScoreDisplay(){this.tabBar.updateScore(this.score)}updateLivesDisplay(){this.tabBar.updateLives(this.lives)}updateLevelDisplay(){this.tabBar.updateLevel(g.getCurrentLevel())}updateProgressDisplay(){const t=g.getLevelProgress();this.progressDisplay.text=`Progress: ${Math.round(t)}%`;const i=g.getCurrentLevel();if(i===3){const s=this.typingTextDisplay.getProgress(),n=this.typingTextDisplay.getTypedText(),l=this.typingTextDisplay.getFullText(),h=n.trim()?n.trim().split(/\s+/).length:0,d=l.trim().split(/\s+/).length;this.progressBar.updateProgressWithTypingProgress(s,h,d)}else{const s=this.totalMessagesInLevel-this.completedMessages;this.progressBar.updateProgress(i,s,this.totalMessagesInLevel)}}async gameOver(){this.wordSpawner.stopSpawning(),this.inputManager.setEnabled(!1),g.setFinalScore(this.score),await x().navigation.showScreen(_t)}prepare(){}update(t){this.paused||(this.wordSpawner.update(t.deltaMS/1e3),this.player.update(t.deltaMS/1e3),this.boss.visible&&(this.boss.update(t.deltaMS/1e3),this.checkPlayerMessageCollisions()),this.updateLevelDisplay(),this.updateProgressDisplay())}async pause(){this.mainContainer.interactiveChildren=!1,this.paused=!0,this.inputManager.setEnabled(!1)}async resume(){this.mainContainer.interactiveChildren=!0,this.paused=!1,this.inputManager.setEnabled(!0)}reset(){this.score=0,this.lives=3,this.wrongCharHighlight=!1,this.clearInput(),this.wordSpawner.clearAllWords(),this.wordSpawner.resetForLevel(),this.player.clearBullets(),this.completedMessages=0,this.totalMessagesInLevel=0,this.typingTextDisplay.reset(),this.boss.reset(),this.boss.visible=!1,this.currentBossText="",this.progressBar.reset(),this.updateScoreDisplay(),this.updateLivesDisplay(),this.updateLevelDisplay(),this.updateProgressDisplay(),this.inputManager.setEnabled(!0),g.isTransitioning()||g.reset()}resize(t,i){const s=t*.5,n=i*.5;this.backgroundSprite.x=s,this.backgroundSprite.y=n,this.backgroundSprite.width=t,this.backgroundSprite.height=i,this.mainContainer.x=s,this.mainContainer.y=n,this.ensurePlayerPosition(),this.tabBar.resize(t-60),this.tabBar.x=30,this.currentInputDisplay.x=50,this.scoreDisplay.x=50,this.livesDisplay.x=50,this.levelDisplay.x=50,this.progressDisplay.x=50,this.typingTextDisplay.resize(t,i),this.progressBar.resize(t,i),this.inputDisplay.x=s-200,this.inputDisplay.y=n+i/2-80}async show(){x().audio.bgm.play("main/sounds/bgm-main.mp3",{volume:.5});const t=[this.pauseButton,this.settingsButton];let i;for(const s of t)s.alpha=0,i=animate(s,{alpha:1},{duration:.3,delay:.75,ease:"backOut"});await i,this.progressBar.show(),this.setupLevelComponents(),this.wordSpawner.resetForLevel(),this.wordSpawner.startSpawning()}setupLevelComponents(){if(g.getCurrentLevel()===3){this.typingTextDisplay.visible=!0,this.boss.visible=!0;const i=V.getRandomText();this.currentBossText=i.text,this.typingTextDisplay.setText(this.currentBossText);const s=V.calculateBossHealth(this.currentBossText);this.boss.setHealth(s),console.log("Level 3 - boss text set:",this.currentBossText),console.log("Level 3 - boss health set:",s),this.boss.show(),this.updateLevel3InputDisplay()}else this.completedMessages=0,this.totalMessagesInLevel=this.wordSpawner.getTotalMessageCount(),this.typingTextDisplay.visible=!1,this.boss.visible=!1}checkPlayerMessageCollisions(){const t=this.wordSpawner.getActiveWords();for(const i of t)i.isPlayerWord()&&i.x>=this.boss.x-50&&!i.isCompleted&&(this.boss.takeDamage(i.targetText.length),i.isCompleted=!0)}async hide(){this.progressBar.hide()}blur(){x().navigation.currentPopup||x().navigation.presentPopup(Pt)}}r(Ee,"assetBundles",["main"]);export{Ee as MainScreen};
